{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "width": "container",
    "height": "container",
    "title": "Distribution of Uber pickups in Manhattan throughout the day, between 01-30 April 2014",

    "params": [{
        "name": "time_of_day",
        "value": 9,
        "bind": {
            "input": "range",
            "min": 0,
            "max": 23,
            "step": 1
        }
    }],

    "projection": {
        "type": "conicEqualArea",
        "parallels": [
            41,
            40
        ],
        "rotate": [
            74.1,
            0,
            0
        ]
    },

    "data": {
        "name": "neighborhood-topo",
        "url": "https://eshjordan.github.io/fit3179-assignment2/data/nyc-neighbourhoods.topojson",
        "format": {
            "type": "topojson",
            "feature": "nyc-neighbourhoods"
        }
    },

    "transform": [{
            "lookup": "properties.neighborhood",
            "from": {
                "data": {
                    "name": "uberdata",
                    "url": "data/manhattan-data-apr14.csv",
                    "format": {
                        "type": "csv"
                    }
                },
                "key": "u_neighborhood",
                "fields": [
                    "u_neighborhood",
                    "u_hr_0",
                    "u_hr_1",
                    "u_hr_2",
                    "u_hr_3",
                    "u_hr_4",
                    "u_hr_5",
                    "u_hr_6",
                    "u_hr_7",
                    "u_hr_8",
                    "u_hr_9",
                    "u_hr_10",
                    "u_hr_11",
                    "u_hr_12",
                    "u_hr_13",
                    "u_hr_14",
                    "u_hr_15",
                    "u_hr_16",
                    "u_hr_17",
                    "u_hr_18",
                    "u_hr_19",
                    "u_hr_20",
                    "u_hr_21",
                    "u_hr_22",
                    "u_hr_23"
                ]
            }
        },

        {
            "filter": "datum.properties.borough == 'Manhattan'"
        },

        {
            "calculate": "datum['u_hr_' + time_of_day]",
            "as": "num_pickups"
        }
    ],
    "layer": [{
        "mark": "geoshape",

        "encoding": {
            "color": {
                "field": "num_pickups",
                "type": "quantitative",
                "legend": {
                    "title": "Number of pickups"
                },
                "scale": {
                    "domain": ["1", "3000"],
                    "scheme": "reds",
                    "type": "pow"
                }
            },

            "tooltip": [{
                    "title": "Neighborhood",
                    "field": "properties.neighborhood"
                },
                {
                    "title": "Number of pickups in neighborhood",
                    "field": "num_pickups"
                }
            ]
        }
    }]
}