{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "width": "container",
    "height": "container",
    "title": "Geographic distribution of Uber trips per 100,000 people per hour",

    "background": "rgba(0, 0, 0, 0)",

    "view": {
        "stroke": "transparent"
    },

    "config": {
        "font": "text-medium",
        "title": {
            "font": "text-medium",
            "fontSize": 14.6666
        }
    },

    "params": [{
            "name": "time_of_day",
            "value": 9,
            "bind": {
                "element": "#time_of_day_external_input"
            }
        },

        {
            "name": "selected_borough",
            "value": "All",
            "bind": {
                "element": "#selected_borough_external_input"
            }
        }
    ],

    "projection": {
        "type": "conicEqualArea",
        "parallels": [
            41,
            40
        ],
        "rotate": [
            74.1,
            0,
            0
        ]
    },

    "data": {
        "name": "neighborhood-topo",
        "url": "https://eshjordan.github.io/fit3179-assignment2/data/nyc-neighbourhoods.topojson",
        "format": {
            "type": "topojson",
            "feature": "nyc-neighbourhoods"
        }
    },

    "transform": [{
            "lookup": "properties.neighborhood",
            "from": {
                "data": {
                    "name": "uberdata",
                    "url": "https://eshjordan.github.io/fit3179-assignment2/data/all-neighborhoods-data-apr14-new.csv",
                    "format": {
                        "type": "csv"
                    }
                },
                "key": "u_neighborhood",
                "fields": [
                    "u_hr_0",
                    "u_hr_1",
                    "u_hr_2",
                    "u_hr_3",
                    "u_hr_4",
                    "u_hr_5",
                    "u_hr_6",
                    "u_hr_7",
                    "u_hr_8",
                    "u_hr_9",
                    "u_hr_10",
                    "u_hr_11",
                    "u_hr_12",
                    "u_hr_13",
                    "u_hr_14",
                    "u_hr_15",
                    "u_hr_16",
                    "u_hr_17",
                    "u_hr_18",
                    "u_hr_19",
                    "u_hr_20",
                    "u_hr_21",
                    "u_hr_22",
                    "u_hr_23"
                ]
            }
        },

        {
            "filter": "datum.properties.borough == selected_borough || selected_borough == 'All'"
        },

        {
            "lookup": "properties.neighborhood",
            "from": {
                "data": {
                    "name": "lookupdata",
                    "url": "https://eshjordan.github.io/fit3179-assignment2/data/neighborhood-lookup.csv",
                    "format": {
                        "type": "csv"
                    }
                },
                "key": "l_neighborhood",
                "fields": [
                    "l_pop_2010"
                ]
            }
        },

        {
            "calculate": "datum.properties.neighborhood == 'John F. Kennedy International Airport' ? datum['u_hr_' + time_of_day] : (datum['u_hr_' + time_of_day] / (datum.l_pop_2010/100000))",
            "as": "norm_pickups_neighborhood"
        }
    ],

    "mark": "geoshape",

    "encoding": {
        "color": {
            "field": "norm_pickups_neighborhood",
            "type": "quantitative",

            "legend": {
                "title": "Trips per 100,000 people"
            },

            "scale": {
                "domain": ["0", "40000"],
                "scheme": "reds",
                "type": "symlog"
            }
        },

        "tooltip": [{
                "title": "Neighborhood",
                "field": "properties.neighborhood"
            },
            {
                "title": "Borough",
                "field": "properties.borough"
            },
            {
                "title": "Trips per 100,000 people",
                "field": "norm_pickups_neighborhood",
                "format": ",.2f"
            }
        ]
    }
}